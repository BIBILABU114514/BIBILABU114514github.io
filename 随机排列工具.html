<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>关键词随机排列工具</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind自定义颜色和字体 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981',
                        accent: '#8B5CF6',
                        neutral: '#64748B',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .card-shadow {
                box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            }
            .hover-lift {
                transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
            }
            .hover-lift:hover {
                transform: translateY(-2px);
                box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            }
            .fade-in {
                animation: fadeIn 0.3s ease-in-out;
            }
            @keyframes fadeIn {
                from { opacity: 0; transform: translateY(10px); }
                to { opacity: 1; transform: translateY(0); }
            }
            .pulse {
                animation: pulse 2s infinite;
            }
            @keyframes pulse {
                0% { transform: scale(1); }
                50% { transform: scale(1.05); }
                100% { transform: scale(1); }
            }
            .scale-in {
                animation: scaleIn 0.2s ease-out;
            }
            @keyframes scaleIn {
                from { transform: scale(0.95); opacity: 0; }
                to { transform: scale(1); opacity: 1; }
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen font-sans">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- 标题区域 -->
        <header class="text-center mb-6 fade-in">
            <h1 class="text-[clamp(2rem,5vw,3rem)] font-bold text-gray-800 mb-2">关键词随机排列工具</h1>
            <p class="text-gray-600 text-lg">自定义多列关键词，一键随机排列组合</p>
        </header>
        
        <!-- 结果预览区域 - 移到最上方 -->
        <div class="bg-white rounded-xl p-6 card-shadow fade-in mb-8" style="animation-delay: 0.1s">
            <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center gap-2">
                <i class="fa fa-star text-accent"></i> 当前随机结果组合
            </h2>
            <div id="previewContainer" class="min-h-[80px] flex items-center justify-center">
                <div class="text-gray-500 py-6">点击随机按钮生成结果</div>
            </div>
        </div>
        
        <!-- 控制区域 -->
        <div class="bg-white rounded-xl p-6 mb-8 card-shadow fade-in" style="animation-delay: 0.2s">
            <div class="flex flex-wrap gap-4 justify-center">
                <button id="addColumn" class="flex items-center gap-2 bg-primary hover:bg-primary/90 text-white px-6 py-3 rounded-lg font-medium hover-lift">
                    <i class="fa fa-plus-circle"></i> 添加列
                </button>
                <button id="randomAll" class="flex items-center gap-2 bg-secondary hover:bg-secondary/90 text-white px-6 py-3 rounded-lg font-medium hover-lift">
                    <i class="fa fa-random"></i> 生成随机组合
                </button>
                <button id="clearAll" class="flex items-center gap-2 bg-neutral hover:bg-neutral/90 text-white px-6 py-3 rounded-lg font-medium hover-lift">
                    <i class="fa fa-trash"></i> 清空所有
                </button>
            </div>
        </div>
        
        <!-- 列容器 -->
        <div id="columnsContainer" class="flex flex-wrap gap-6 mb-10">
            <!-- 初始列 - 名称列 -->
            <div class="column bg-white rounded-xl p-5 card-shadow flex-1 min-w-[280px] fade-in" style="animation-delay: 0.3s">
                <div class="flex items-center justify-between mb-4">
                    <input type="text" class="column-title text-xl font-semibold text-gray-800 border-b-2 border-primary p-2 w-full focus:outline-none focus:border-accent transition-colors" value="名称" placeholder="列标题">
                    <button class="delete-column text-gray-400 hover:text-red-500 ml-2 p-2 transition-colors">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 列随机结果显示框 -->
                <div class="column-result bg-accent/5 border border-accent/20 rounded-lg p-3 mb-4">
                    <span class="text-sm text-gray-500">当前随机结果：</span>
                    <span class="column-result-text font-medium text-accent">-</span>
                </div>
                
                <!-- 按钮区域 - 添加词条和随机此列并排 -->
                <div class="flex gap-3 mb-4">
                    <button class="add-entry flex-1 flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover-lift">
                        <i class="fa fa-plus"></i> 添加词条
                    </button>
                    <button class="random-column bg-accent/10 hover:bg-accent/20 text-accent p-2 rounded-lg hover-lift">
                        <i class="fa fa-refresh"></i> 随机此列
                    </button>
                </div>
                
                <!-- 限制列的高度 -->
                <div class="entries-container space-y-3 max-h-[300px] overflow-y-auto pr-2 border rounded-lg p-3 bg-gray-50">
                    <div class="entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" value="产品A" placeholder="输入关键词">
                        <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                    <div class="entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" value="产品B" placeholder="输入关键词">
                        <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 初始列 - 时间列 -->
            <div class="column bg-white rounded-xl p-5 card-shadow flex-1 min-w-[280px] fade-in" style="animation-delay: 0.4s">
                <div class="flex items-center justify-between mb-4">
                    <input type="text" class="column-title text-xl font-semibold text-gray-800 border-b-2 border-primary p-2 w-full focus:outline-none focus:border-accent transition-colors" value="时间" placeholder="列标题">
                    <button class="delete-column text-gray-400 hover:text-red-500 ml-2 p-2 transition-colors">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 列随机结果显示框 -->
                <div class="column-result bg-accent/5 border border-accent/20 rounded-lg p-3 mb-4">
                    <span class="text-sm text-gray-500">当前随机结果：</span>
                    <span class="column-result-text font-medium text-accent">-</span>
                </div>
                
                <!-- 按钮区域 - 添加词条和随机此列并排 -->
                <div class="flex gap-3 mb-4">
                    <button class="add-entry flex-1 flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover-lift">
                        <i class="fa fa-plus"></i> 添加词条
                    </button>
                    <button class="random-column bg-accent/10 hover:bg-accent/20 text-accent p-2 rounded-lg hover-lift">
                        <i class="fa fa-refresh"></i> 随机此列
                    </button>
                </div>
                
                <!-- 限制列的高度 -->
                <div class="entries-container space-y-3 max-h-[300px] overflow-y-auto pr-2 border rounded-lg p-3 bg-gray-50">
                    <div class="entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" value="早上" placeholder="输入关键词">
                        <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                    <div class="entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" value="中午" placeholder="输入关键词">
                        <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                    <div class="entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" value="晚上" placeholder="输入关键词">
                        <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 页脚 -->
        <footer class="mt-12 text-center text-gray-500 text-sm">
            <p>关键词随机排列工具 &copy; 2023</p>
        </footer>
    </div>

    <script>
        // DOM 元素
        const columnsContainer = document.getElementById('columnsContainer');
        const addColumnBtn = document.getElementById('addColumn');
        const randomAllBtn = document.getElementById('randomAll');
        const clearAllBtn = document.getElementById('clearAll');
        const previewContainer = document.getElementById('previewContainer');
        
        // 初始化列计数器
        let columnCounter = document.querySelectorAll('.column').length;
        
        // 添加新列
        addColumnBtn.addEventListener('click', () => {
            columnCounter++;
            
            const newColumn = document.createElement('div');
            newColumn.className = 'column bg-white rounded-xl p-5 card-shadow flex-1 min-w-[280px] fade-in';
            newColumn.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <input type="text" class="column-title text-xl font-semibold text-gray-800 border-b-2 border-primary p-2 w-full focus:outline-none focus:border-accent transition-colors" value="列 ${columnCounter}" placeholder="列标题">
                    <button class="delete-column text-gray-400 hover:text-red-500 ml-2 p-2 transition-colors">
                        <i class="fa fa-times"></i>
                    </button>
                </div>
                
                <!-- 列随机结果显示框 -->
                <div class="column-result bg-accent/5 border border-accent/20 rounded-lg p-3 mb-4">
                    <span class="text-sm text-gray-500">当前随机结果：</span>
                    <span class="column-result-text font-medium text-accent">-</span>
                </div>
                
                <!-- 按钮区域 - 添加词条和随机此列并排 -->
                <div class="flex gap-3 mb-4">
                    <button class="add-entry flex-1 flex items-center justify-center gap-2 bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover-lift">
                        <i class="fa fa-plus"></i> 添加词条
                    </button>
                    <button class="random-column bg-accent/10 hover:bg-accent/20 text-accent p-2 rounded-lg hover-lift">
                        <i class="fa fa-refresh"></i> 随机此列
                    </button>
                </div>
                
                <div class="entries-container space-y-3 max-h-[300px] overflow-y-auto pr-2 border rounded-lg p-3 bg-gray-50">
                    <div class="entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm">
                        <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" placeholder="输入关键词">
                        <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                            <i class="fa fa-times-circle"></i>
                        </button>
                    </div>
                </div>
            `;
            
            columnsContainer.appendChild(newColumn);
            setupColumnEvents(newColumn);
            
            // 滚动到新添加的列
            newColumn.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        });
        
        // 检查词条是否重复
        function isDuplicateEntry(column, value, currentInput = null) {
            if (!value.trim()) return false; // 空值不算重复
            
            const entries = column.querySelectorAll('.entry-text');
            for (let entry of entries) {
                // 跳过当前正在编辑的输入框
                if (entry === currentInput) continue;
                
                if (entry.value.trim().toLowerCase() === value.trim().toLowerCase()) {
                    return true;
                }
            }
            return false;
        }
        
        // 显示错误提示
        function showError(message, element) {
            // 移除已有的错误提示
            const existingError = element.parentElement.querySelector('.error-message');
            if (existingError) {
                existingError.remove();
            }
            
            // 创建新的错误提示
            const errorElement = document.createElement('div');
            errorElement.className = 'error-message text-red-500 text-sm mt-1 fade-in';
            errorElement.textContent = message;
            
            // 添加到DOM
            element.parentElement.appendChild(errorElement);
            
            // 添加抖动效果
            element.classList.add('ring-2', 'ring-red-300');
            setTimeout(() => {
                element.classList.remove('ring-2', 'ring-red-300');
            }, 1000);
            
            // 3秒后自动移除错误提示
            setTimeout(() => {
                errorElement.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(() => errorElement.remove(), 300);
            }, 3000);
        }
        
        // 为列设置事件监听
        function setupColumnEvents(column) {
            // 添加词条 - 新词条放在最上面
            const addEntryBtn = column.querySelector('.add-entry');
            addEntryBtn.addEventListener('click', () => {
                const entriesContainer = column.querySelector('.entries-container');
                const newEntry = document.createElement('div');
                newEntry.className = 'entry flex items-center gap-2 p-3 bg-white rounded-lg hover:bg-gray-50 transition-colors shadow-sm scale-in';
                newEntry.innerHTML = `
                    <input type="text" class="entry-text flex-1 bg-transparent border-none focus:outline-none" placeholder="输入关键词">
                    <button class="delete-entry text-gray-400 hover:text-red-500 p-1 transition-colors">
                        <i class="fa fa-times-circle"></i>
                    </button>
                `;
                
                // 添加到容器的最前面
                if (entriesContainer.firstChild) {
                    entriesContainer.insertBefore(newEntry, entriesContainer.firstChild);
                } else {
                    entriesContainer.appendChild(newEntry);
                }
                
                const entryInput = newEntry.querySelector('.entry-text');
                
                // 自动聚焦到新词条
                entryInput.focus();
                
                // 为新词条添加删除事件
                newEntry.querySelector('.delete-entry').addEventListener('click', () => {
                    // 确保至少保留一个词条
                    if (entriesContainer.children.length > 1) {
                        newEntry.classList.add('opacity-0', 'transform', 'translate-y-2');
                        newEntry.style.transition = 'opacity 0.2s, transform 0.2s';
                        setTimeout(() => newEntry.remove(), 200);
                    } else {
                        // 只保留一个时清空内容
                        entryInput.value = '';
                    }
                    updateColumnRandomResult(column);
                    updateMainResult();
                });
                
                // 输入时检查重复
                entryInput.addEventListener('blur', () => {
                    const value = entryInput.value;
                    if (isDuplicateEntry(column, value, entryInput)) {
                        showError('词条已存在，请输入不同的内容', entryInput);
                        // 只清空，不删除输入框
                        entryInput.value = '';
                    }
                    updateColumnRandomResult(column);
                    updateMainResult();
                });
                
                // 输入变化时更新结果
                entryInput.addEventListener('input', () => {
                    updateColumnRandomResult(column);
                    updateMainResult();
                });
            });
            
            // 为现有词条添加重复检查和事件监听
            const entryInputs = column.querySelectorAll('.entry-text');
            entryInputs.forEach(input => {
                // 失去焦点时检查重复
                input.addEventListener('blur', () => {
                    const value = input.value;
                    if (isDuplicateEntry(column, value, input)) {
                        showError('词条已存在，请输入不同的内容', input);
                        input.value = ''; // 只清空，不删除
                    }
                    updateColumnRandomResult(column);
                    updateMainResult();
                });
                
                // 输入变化时更新结果
                input.addEventListener('input', () => {
                    updateColumnRandomResult(column);
                    updateMainResult();
                });
            });
            
            // 删除词条
            const deleteEntryBtns = column.querySelectorAll('.delete-entry');
            deleteEntryBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const entry = btn.closest('.entry');
                    const entriesContainer = column.querySelector('.entries-container');
                    
                    // 确保至少保留一个词条
                    if (entriesContainer.children.length > 1) {
                        entry.classList.add('opacity-0', 'transform', 'translate-y-2');
                        entry.style.transition = 'opacity 0.2s, transform 0.2s';
                        setTimeout(() => entry.remove(), 200);
                    } else {
                        // 只保留一个时清空内容
                        entry.querySelector('.entry-text').value = '';
                    }
                    updateColumnRandomResult(column);
                    updateMainResult();
                });
            });
            
            // 单列随机
            const randomColumnBtn = column.querySelector('.random-column');
            randomColumnBtn.addEventListener('click', () => {
                shuffleEntries(column);
                updateColumnRandomResult(column);
                updateMainResult();
            });
            
            // 删除列
            const deleteColumnBtn = column.querySelector('.delete-column');
            deleteColumnBtn.addEventListener('click', () => {
                // 确保至少保留一列
                if (columnsContainer.children.length > 1) {
                    column.classList.add('opacity-0', 'transform', 'scale-95');
                    column.style.transition = 'opacity 0.2s, transform 0.2s';
                    setTimeout(() => column.remove(), 200);
                    updateMainResult();
                } else {
                    // 只保留一列时清空所有词条
                    const entries = column.querySelectorAll('.entry-text');
                    entries.forEach(entry => entry.value = '');
                    updateColumnRandomResult(column);
                    updateMainResult();
                }
            });
            
            // 列标题变化时更新结果
            column.querySelector('.column-title').addEventListener('input', () => {
                updateMainResult();
            });
            
            // 初始化列随机结果
            updateColumnRandomResult(column);
        }
        
        // 更新列的随机结果显示
        function updateColumnRandomResult(column) {
            const resultElement = column.querySelector('.column-result-text');
            const entries = Array.from(column.querySelectorAll('.entry-text'))
                .map(entry => entry.value.trim())
                .filter(value => value);
            
            if (entries.length > 0) {
                // 显示第一个词条作为默认
                resultElement.textContent = entries[0];
            } else {
                resultElement.textContent = '-';
            }
        }
        
        // 洗牌算法 - Fisher-Yates 算法
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
        
        // 从数组中随机选择一个元素
        function getRandomItem(array) {
            if (array.length === 0) return null;
            return array[Math.floor(Math.random() * array.length)];
        }
        
        // 随机排列指定列的词条并更新随机结果
        function shuffleEntries(column) {
            const entriesContainer = column.querySelector('.entries-container');
            const entries = Array.from(entriesContainer.querySelectorAll('.entry'));
            
            // 保存词条内容
            const entryValues = entries.map(entry => entry.querySelector('.entry-text').value);
            
            // 洗牌
            const shuffledValues = shuffleArray(entryValues);
            
            // 添加动画效果
            entries.forEach(entry => {
                entry.classList.add('opacity-0', 'transform', 'translate-x-4');
                entry.style.transition = 'opacity 0.3s, transform 0.3s';
            });
            
            // 延迟后更新内容并恢复显示
            setTimeout(() => {
                entries.forEach((entry, index) => {
                    entry.querySelector('.entry-text').value = shuffledValues[index];
                    entry.classList.remove('opacity-0', 'transform', 'translate-x-4');
                });
                
                // 更新列随机结果
                const resultElement = column.querySelector('.column-result-text');
                const validEntries = shuffledValues.filter(v => v.trim());
                if (validEntries.length > 0) {
                    resultElement.textContent = validEntries[0];
                    // 添加动画效果突出显示新结果
                    resultElement.classList.add('pulse');
                    setTimeout(() => resultElement.classList.remove('pulse'), 1000);
                }
            }, 300);
        }
        
        // 生成主随机结果
        function generateMainResult() {
            const columns = document.querySelectorAll('.column');
            const result = [];
            
            columns.forEach((column, index) => {
                // 为每列添加一点延迟，创造错开的动画效果
                setTimeout(() => shuffleEntries(column), index * 100);
                
                // 收集有效的词条
                const entries = Array.from(column.querySelectorAll('.entry-text'))
                    .map(entry => entry.value.trim())
                    .filter(value => value);
                
                // 获取列标题
                const title = column.querySelector('.column-title').value || `列 ${index + 1}`;
                
                // 随机选择一个词条
                const randomEntry = getRandomItem(entries);
                
                if (randomEntry) {
                    result.push({
                        title,
                        value: randomEntry
                    });
                }
            });
            
            // 延迟后更新结果显示，等待所有动画完成
            setTimeout(() => {
                displayMainResult(result);
            }, 500 + columns.length * 100);
        }
        
        // 显示主随机结果
        function displayMainResult(result) {
            if (result.length === 0) {
                previewContainer.innerHTML = '<div class="text-gray-500 py-6">请添加词条后再生成随机结果</div>';
                return;
            }
            
            // 创建结果HTML
            let resultHtml = '<div class="flex flex-wrap gap-4 justify-center items-center p-4 w-full">';
            
            result.forEach((item, index) => {
                resultHtml += `
                    <div class="flex flex-col items-center bg-gradient-to-br from-primary/10 to-accent/10 rounded-lg p-4 min-w-[120px] pulse" style="animation-delay: ${index * 0.1}s">
                        <span class="text-sm text-gray-600 mb-1">${item.title}</span>
                        <span class="text-lg font-semibold text-gray-800">${item.value}</span>
                    </div>
                `;
            });
            
            resultHtml += '</div>';
            previewContainer.innerHTML = resultHtml;
        }
        
        // 更新主结果
        function updateMainResult() {
            const columns = document.querySelectorAll('.column');
            const result = [];
            
            columns.forEach((column, index) => {
                // 收集有效的词条
                const entries = Array.from(column.querySelectorAll('.entry-text'))
                    .map(entry => entry.value.trim())
                    .filter(value => value);
                
                // 获取列标题
                const title = column.querySelector('.column-title').value || `列 ${index + 1}`;
                
                // 获取当前列显示的随机结果
                const columnResult = column.querySelector('.column-result-text').textContent;
                
                if (entries.length > 0) {
                    result.push({
                        title,
                        value: columnResult !== '-' ? columnResult : entries[0]
                    });
                }
            });
            
            displayMainResult(result);
        }
        
        // 所有列一起随机并生成主结果
        randomAllBtn.addEventListener('click', generateMainResult);
        
        // 清空所有内容
        clearAllBtn.addEventListener('click', () => {
            if (confirm('确定要清空所有列和词条吗？')) {
                const entries = document.querySelectorAll('.entry-text');
                entries.forEach(entry => {
                    entry.value = '';
                });
                
                // 更新所有列的随机结果显示
                document.querySelectorAll('.column').forEach(column => {
                    updateColumnRandomResult(column);
                });
                
                updateMainResult();
            }
        });
        
        // 初始化所有现有列的事件
        document.querySelectorAll('.column').forEach(setupColumnEvents);
        
        // 初始更新主结果
        updateMainResult();
    </script>
</body>
</html>
